# Архитектура компонентов (Component Design) — Batumi Trip

## Иерархия компонентов
* **Layout** (глобальный макет)
  ├─ **Header** (навигационная панель с логотипом/названием и кнопкой авторизации)
  ├─ **LoginModal** (всплывающее окно авторизации)
  ├─ **Основная часть страницы (Main Content)**
      ├─ **LocationListPage** (главная страница со списком локаций и поиском)
      │    ├─ **SearchBar** (компонент поиска по заголовку и тегу)
      │    ├─ **AddLocationButton** (кнопка перехода к форме добавления локации)
      │    └─ **LocationList** (контейнер для списка карточек локаций)
      │        ├─ **LocationCard** (карточка локации для каждой записи)
      │        │  └─ **TagBadge** (отдельный компонент для отображения тега внутри карточки)
      │        └─ **SkeletonCard** (скелетон-заглушка при загрузке списка)
      ├─ **LocationDetailPage** (страница детальной информации о выбранной локации)
      │    ├─ **LocationDetail** (компонент отображения полной информации локации)
      │    │  └─ **TagBadge** (список тегов локации)
      │    ├─ **EditButton** (кнопка редактирования локации)
      │    └─ **DeleteButton** (кнопка удаления локации)
      └─ **AddLocationPage** (страница формы добавления локации)
          └─ **LocationForm** (компонент формы для создания/редактирования локации)

---
## Описание компонентов в очереди на раелизацию (Актуальный код: *ещё не рализован*)

### SearchBar

* **Назначение:** Поле поиска по заголовкам и тегам локаций.
* **Пропсы:** Опционально `placeholder: string` (текст подсказки).
* **Взаимодействие:** Пользователь вводит текст, он сохраняется в глобальном состоянии (например, Zustand) как текущий поисковый запрос (`searchQuery`). Поисковое состояние используют `useLocations` или компонент списка для фильтрации вывода. Возможна функциональность debounce (задержка поиска после ввода) для оптимизации запросов.
* **Используемые библиотеки:** shadcn (`Input`), Tailwind для стилей, Zustand для хранения `searchQuery`.
**Актаульный код SearchBar:** *Ещё не рализован*

### TagBadge

* **Назначение:** Визуальный компонент для отображения отдельного тега (например, категории) локации.
* **Пропсы:** `name: string` — текст тега. Возможно `onClick?: (tag: string) => void` для обработки клика.
* **Контракты:** Получает имя тега из данных. Теги формируются из таблицы `tags` или через запрос связей `locations_tags`.
* **Взаимодействие:** Показывает слово в рамке или подложке (badge), стиль — фоновый цвет и скругления через Tailwind. При клике (если задан `onClick`) может обновлять глобальное состояние фильтра (Zustand), чтобы отфильтровать список по выбранному тегу. Используется внутри `LocationCard` и `LocationDetail`.
* **Используемые библиотеки:** Tailwind для стиля бейджа, shadcn возможен для Badge-стиля, Framer Motion — опционально для эффекта наведения.
**Актаульный код TagBadge:** *Ещё не рализован*

### LocationDetailPage (Страница подробной информации)

* **Назначение:** Страница с полным описанием выбранной локации.
* **Пропсы:** Параметр `id` из маршрута (Next.js Dynamic Route).
* **Взаимодействие:** При получении параметра `id` вызывает `useOneLocation(id)` `(useQuery(['location', id]))` для загрузки объекта; данные передаёт в `LocationDetail`. Кнопки `EditButton` и `DeleteButton` используют хуки `useUpdateLocation()` и `useDeleteLocation()` соответственно.
* **Используемые библиотеки:** React Query (`useQuery` для получения одной локации), Tailwind для разметки, shadcn (`Button`), Framer Motion (необязательно для плавного появления контента).
**Актаульный код LocationDetailPage:** *Ещё не рализован*

### LocationDetail

* **Назначение:** Компонент отображения подробных данных локации (используется на `LocationDetailPage`).
* **Пропсы:**

  * `title: string`
  * `description: string`
  * `imageUrl: string`
  * `address: string`
  * `cost: string`
  * `sourceUrl: string`
  * `tags: string[]`
* **Взаимодействие:** Показывает большие изображение и все текстовые поля локации. Теги выводит через `TagBadge`. Кнопки `EditButton` и `DeleteButton` (связанные с тем же `id`) располагаются рядом. Адрес можно сделать кликабельным (ссылка на Google Maps), `sourceUrl` — внешний ресурс.
* **Используемые библиотеки:** Tailwind (верстка), shadcn (возможные компоненты `Card`, `Image`), Framer Motion для плавного анимационного эффекта при появлении страницы.
**Актаульный код LocationDetail:** *Ещё не рализован*

### EditButton

* **Назначение:** Кнопка для перехода к форме редактирования текущей локации.
* **Пропсы:** `locationId: string`
* **Взаимодействие:** При клике вызывает `router.push('/locations/${locationId}/edit')` (если есть отдельный маршрут редактирования) или открывает `LocationForm` с начальной функцией. Может быть реализована как ссылка.
* **Используемые библиотеки:** shadcn (`Button`), Tailwind.
**Актаульный код EditButton:** *Ещё не рализован*

### DeleteButton

* **Назначение:** Кнопка для удаления текущей локации.
* **Пропсы:** `locationId: string`, `onDeleted?: () => void` (коллбэк после успешного удаления).
* **Взаимодействие:** При нажатии запрашивает подтверждение удаления (например, через браузерное `confirm` или дополнительный модальный диалог). После подтверждения вызывает API (через React Query `useMutation` или Supabase SDK) метод удаления записи из таблицы `locations`. По успешному удалению вызывает `onDeleted` (обычно перенаправляет на главную страницу).
* **Используемые библиотеки:** shadcn (`Button`), Tailwind, React Query для мутации.
**Актаульный код DeleteButton:** *Ещё не рализован*

### AddLocationPage

* **Назначение:** Страница с формой создания новой локации.
* **Пропсы:** Нет.
* **Взаимодействие:** Содержит `LocationForm` без `initialData`. Сабмит формы вызывает `useAddLocation().mutate(data)`, а при успехе перенаправляет на детальную страницу новой локации.
* **Используемые библиотеки:** React Hook Form (или аналог) для обработки формы, shadcn для элементов формы, Tailwind для верстки.
**Актаульный код AddLocationPage:** *Ещё не рализован*

### LocationForm

* **Назначение:** Универсальная форма для добавления или редактирования локации.
* **Пропсы:** Возможно `initialData?: Location` (для редактирования) и `onSubmit?: (data) => void`.
* **Контракты:** Поля формы соответствуют колонкам таблицы `locations`: заголовок, описание, адрес, стоимость, URL, а также выбор тегов и загрузка изображения.
* **Взаимодействие:** В режиме добавления (`initialData` отсутствует) при сабмите вызывает `useMutation` для `POST /locations`. В режиме редактирования вызывает `PATCH` с существующим `id`. Для тегов использует список из таблицы `tags` (подача либо select-опций, либо ввод/предложение). Для загрузки изображения вызывает Supabase Storage или другую API. После успешной операции могут быть вызваны callback и навигация.
* **Работа с тегами:** При изменении списка тегов вызываются RPC‑функции: `add_location_tag({ location_id, tag_id })` для добавления, `remove_location_tag({ location_id, tag_id })` для удаления. Эти вызовы обёрнуты в useMutation‑хуки и сопровождаются оптимистическим обновлением кеша `['location', id]`.
* **Используемые библиотеки:** React Hook Form (взаимодействие с полями), shadcn (`Form`, `Input`, `Textarea`, `Select`, `Button`, `File Upload`), Tailwind. Framer Motion может анимировать динамический добавление полей (например, новые теги).
**Актаульный код LocationForm:** *Ещё не рализован*

---
## Пользовательские хуки и глобальное состояние

### useOneLocation.js

* **Назначение:** Кастомный хук для загрузки одной локации по `id` вместе с привязанными тегами и признаком «избранное» для текущего пользователя.
* **Функционал:** 
  * Оборачивает `useQuery(['location', id], fetcher`, `{ staleTime: 60_000 }).`
  * fetcher делает запрос к Supabase REST:
  `GET /rest/v1/locations?id=eq.{id}&select=*,tags(*),favourites(user_id)&limit=1.`
  * В респонсе вычисляет `isFavourite = favourites.length > 0.`
  * При ошибке — выводит `toast` через `react-hot-toast`.
* **Использование:** Применяется в `LocationDetailPage`, `LocationForm` (режим Edit) и в модалке быстрого предпросмотра.
**Актаульный код useOneLocation.js:** *Ещё не рализован*

### useAddLocation

* **Назначение:** Мутация для создания новой локации.
* **Функционал:** 
  * `useMutation(addLocationFn, { onSuccess }).`
  * `addLocationFn` загружает изображение в Supabase Storage (если файл присутствует), получает `publicUrl`, затем `POST /rest/v1/locations` c телом `{ …payload, image_url: publicUrl }`.
  * В `onSuccess` инвалидируются `['locations']` и `['tags']`.
* **Использование:** `LocationForm` в `AddLocationPage`
**Актаульный код useAddLocation:** *Ещё не рализован*

### useUpdateLocation

* **Назначение:** Мутация для обновления существующей локации.
* **Функционал:**
  * `useMutation(({ id, ...patch }) => PATCH /rest/v1/locations?id=eq.{id}).`
  * При обновлении тегов вызывает RPC `sync_location_tags(location_id, tag_ids[])`.
  * Инвалидирует `['location', id]` и `['locations']`. 
* **Использование:** Кнопка `Save` в `LocationForm` (режим Edit) и `EditButton` на детальной странице.
**Актаульный код useUpdateLocation:** *Ещё не рализован*

### useDeleteLocation

* **Назначение:** Мутация для удаления локации.
* **Функционал:**
  * `useMutation(id => DELETE /rest/v1/locations?id=eq.{id})`.
  * Удаляет связанные избранные: `DELETE /rest/v1/favourites?location_id=eq.{id}`.
  * Инвалидирует `['locations']`, `['favourites', userId]` и очищает `favorites` в Zustand.
* **Использование:** `DeleteButton` на `LocationDetailPage`; после успеха выполняет `router.push('/')`.
**Актаульный код useDeleteLocation:** *Ещё не рализован*

### useTags

* **Назначение:** Хук для получения и кеширования списка тегов.
* **Функционал:**
  * `useQuery(['tags'], () => GET /rest/v1/tags?select=*)`, `{ staleTime: 5*60_000 }`.
  * Возвращает массив тегов, доступный для фильтрации и автодополнения в формах.
* **Использование:** `SearchBar` (фильтр), `LocationForm` (multi‑select теги), а также страницы аналитики.
**Актаульный код useTags:** *Ещё не рализован*

### useToggleFavourite

* **Назначение:** Мутация‑переключатель «добавить / удалить в избранное» для текущего пользователя.
* **Функционал:**
  * Если локация не любима → `POST /rest/v1/favourites { user_id, location_id }`.
  * Иначе → `DELETE /rest/v1/favourites?user_id=eq.{uid}&location_id=eq.{id}`.
  * Оптимистично обновляет `favorites` в Zustand (`toggleFavorite(id)`) и инвалидирует `['favourites', userId]`, `['location', id]`, `['locations']`.
* **Использование:** Вызывается внутри LocationCard при клике на иконку избранное⭐
**Актаульный код useToggleFavourite:** *Ещё не рализован*

> **Библиотеки для UI и анимаций:** Все компоненты стилизуются с помощью Tailwind CSS. Для унифицированного дизайна используются готовые элементы из библиотеки shadcn (Buttons, Inputs, Cards, Modal, Form). Анимации при появлении элементов (загрузка, переходы, появление карточек) реализуются через Framer Motion (например, `motion.div` для плавного фейда или анимирования Skeleton-эффекта).

---